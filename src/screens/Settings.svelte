<!-- You probably know what this is. -->
<script>
	const themes = ["orange", "blue", "purple", "green", "red"];
	const fonts = ["default", "monospace"];
	import Container from "../lib/Container.svelte";

	import {user, modalShown, modalPage} from "../lib/stores.js";
	import * as clm from "../lib/clmanager.js";
	function StoreFont(fonttostore) {
		localStorage.setItem('font', fonttostore)
	}
	function GetFont() {
		return(localStorage.getItem('font'))
	}
	var currentfont = GetFont()
	function StoreDir(fonttostore) {
		localStorage.setItem('dir', fonttostore)
	}
	function GetDir() {
		return(localStorage.getItem('dir'))
	}
	if(GetDir() == null) {StoreDir("up")}
	var currentdir = GetDir()
</script>

<!--
	<p>Quote: {$user.quote}</p>
	<form
		class="createpost"
		on:submit|preventDefault={e => {
			//spinner.set(true);
			const _user = $user;
			_user.quote = e.target[0].value;
			user.set(_user);

			clm.updateProfile();
			//spinner.set(false);
		}}
	>
		<input
			type="text"
			class="white"
			placeholder="Write something..."
				id="qinput"
				name="qinput"
			autocomplete="false"
		>
		<button>Save Quote</button>
	</form>
-->
<Container>
	<h1>Settings</h1>
	You can change your settings here. These will save to your account, so they will
	carry over into other clients.
</Container>
<Container>
	<div class="settings-controls">
		<button
			class="circle settings"
			on:click={() => {
				const _user = $user;
				_user.layout = _user.layout === "new" ? "old" : "new";
				user.set(_user);

				clm.updateProfile();
			}}
		/>
	</div>

	<h2>Layout</h2>
	The layout is currently set to {$user.layout}.
</Container>
<Container>
	<div class="settings-controls">
		<button
			class="circle settings"
			on:click={() => {
				const _user = $user;
				_user.theme = themes[((themes.indexOf(_user.theme) ?? -1) + 1) % themes.length]
				user.set(_user);

				clm.updateProfile();
			}}
		/>
	</div>

	<h2>Theme</h2>
	The theme is currently set to {$user.theme}.
</Container>
<Container>
	<div class="settings-controls">
		<button
			class="circle settings"
			on:click={() => {
				const _user = {}
				_user.dir = GetDir()
				_user.dir = _user.dir == "up" ? "down" : "up"
				StoreDir(_user.dir)
				currentdir = GetDir()
				clm.updateProfile();
			}}
		/>
	</div>

	<h2>Theme</h2>
	The chat direction is currently set to null.
</Container>
<Container>
	<div class="settings-controls">
		<button
			class="circle settings"
			on:click={() => {
				const _user = {}
				_user.font = GetFont()
				console.log({"OldFont":GetFont(),"OldFontID":fonts.indexOf(_user.font),"FontsList":fonts,"NewFont":fonts[((fonts.indexOf(_user.font) ?? -1) + 1) % fonts.length]})
				_user.font = fonts[((fonts.indexOf(_user.font) ?? -1) + 1) % fonts.length]
				StoreFont(_user.font)
				currentfont = GetFont()
				clm.updateProfile();

			}}
		/>
	</div>

	<h2>Font</h2>
	The font is currently set to {currentfont}.
</Container>
<Container>
	<div class="settings-controls">
		<input
			type="checkbox"
			checked={!$user.mode}
			on:change={() => {
				const _user = $user;
				_user.mode = !_user.mode;
				user.set(_user);

				clm.updateProfile();
			}}
		/>
	</div>

	<h2>Dark Mode</h2>
	Dark mode is currently {$user.mode ? "disabled" : "enabled"}.
</Container>
<Container>
	<div class="settings-controls">
		<input
			type="checkbox"
			checked={$user.sfx}
			on:change={() => {
				const _user = $user;
				_user.sfx = !_user.sfx;
				user.set(_user);

				clm.updateProfile();
			}}
		/>
	</div>

	<h2>Sound Effects</h2>
	Sound effects (for new messages) are currently {!$user.sfx
		? "disabled"
		: "enabled"}.
</Container>
<Container>
	<div class="settings-controls">
		<input
			type="checkbox"
			checked={$user.bgm}
			on:change={()=>{
				const _user = $user;
				_user.bgm = !_user.bgm;
				user.set(_user);

				clm.updateProfile();
			}}
		>
	</div>

<!-- 	<h2>BGM</h2>
	BGM is currently {!$user.sfx ? "disabled" : "enabled"}.
</Container>
{#if $user.name}
	<Container>
		<div class="settings-controls">
			<button
				class="circle settings"
				on:click={() => {
					$modalPage = "changePassword";
					$modalShown = true;
				}}
			/>
		</div> -->

		<h2>Change Password</h2>
		Change your account password.
	</Container>
	<Container>
		<div class="settings-controls">
			<button
				class="circle settings"
				on:click={() => {
					$modalPage = "deleteAccount";
					$modalShown = true;
				}}
			/>
		</div>

		<h2>Delete Account</h2>
			Permanently delete your Meower account. <span style="color:red;">THIS CANNOT BE UNDONE.</span>
	</Container>
	<Container>
		<div class="settings-controls">
			<button
				class="circle settings"
				on:click={() => {
					modalPage.set("logout");
					modalShown.set(true);
				}}
			/>
		</div>

		<h2>Log out</h2>
		Log out of your account
	</Container>
		

<!--
	{"cmd": "direct", "val": {"cmd": "del_tokens", "val": ""}, "listener": "del_tokens"}
-->

<div class="eee" />

<style>
	.settings-controls {
		position: absolute;
		top: 0.25em;
		right: 0.25em;
	}

	input[type="checkbox"],
	button.circle {
		border: none;
		margin: 0;
		margin-left: 0.125em;
	}
</style>
